machine:
  services:
    - docker
  environment:
    COMPOSE_PROJECT_NAME: 'addonsserver'
    DOCKER_NAME: 'addonsserver_web_1'

dependencies:
  override:
    - pip install -r requirements/uitest.txt

test:
  pre:
    - docker-compose pull
    - docker-compose up -d
    - sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' $DOCKER_NAME)" -- bash -c "cd code && make initialize_docker_inner"
  override:
    - mv conftest.py _conftest.py
    - py.test --base-url http://$(docker inspect --format '{{ .NetworkSettings.IPAddress }}' $DOCKER_NAME) --driver Firefox --html $CIRCLE_ARTIFACTS/results.html --junitxml $CIRCLE_TEST_REPORTS/junit.xml
